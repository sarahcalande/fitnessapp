<main class="group content" id="food-diary">
  <h1>Your food diary</h1>

  <section id="diary-entry" class="group">
    <% (0..5).each do |num| %>
      <% if @diary.try("meal#{num}".to_sym) %>
        <h2><%= @diary.send("meal#{num}".to_sym) %></h2>

        <% @meal_entries.each do |entry| %>
          <% if entry.meal_id == num %>
            <% nutrients = calculate_by_quantity(entry.food, entry.quantity) %>

        <div class="group meal">
          <section class="food-name">
            <%= entry.food.name.capitalize %>
          </section>

          <section class="nutrient-table">
            <table>
              <tbody>
                <tr>
                  <td><%= nutrients["calories"].round %></td>
                  <td><%= nutrients["fat"].round %></td>
                  <td><%= nutrients["carbohydrates"].round %></td>
                  <td><%= nutrients["protein"].round %></td>
                </tr>
              </tbody>
            </table>
          </section>
        </div>
          <% end %>
        <% end %>

        <% if @user == current_user %>
          <li><%= link_to "Add food", daily_entry_foods_url(@entry, { meal_num: num }) %></li>
        <% end %>
    </ul>
    </div>
      <% else %>
        <% break %>
      <% end %>
    <% end %>
  </section>

  <section class="group totals">
    <div class="group" id="diary-totals">
      <table>
        <tfoot>
          <th>Calories</th>
          <th>Fat</th>
          <th>Carbs</th>
          <th>Protein</th>
        </tfoot>

        <tr>
          <td><%= @entry.calories_consumed.round %></td>
          <td><%= @entry.fat_intake.round %></td>
          <td><%= @entry.carbohydrate_intake.round %></td>
          <td><%= @entry.protein_intake.round %></td>
        </tr>

        <% if @user.goal %>
        <tr>
          <td><%= @user.goal.calorie_goal %></td>
          <td><%= %></td>
          <td><%= %></td>
          <td><%= %></td>
        </tr>

        <tr>
          <td><%= @user.goal.calorie_goal - @entry.calories_consumed %></td>
          <td><%= %></td>
          <td><%= %></td>
          <td><%= %></td>
        </tr>
        <% end %>
      </table>
    </div>
  </section>

  <section>
    <% body = "completed a food journal for #{@entry.entry_date}" %>
    <%= button_to "Publish this entry!", daily_entry_feed_items_url(@entry.id, owner_type: "DailyEntry", body: body) %>
  </section>

</main>